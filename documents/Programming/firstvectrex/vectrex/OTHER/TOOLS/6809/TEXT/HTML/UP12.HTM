<HTML>
<HEAD><TITLE>MICROPROCESSORS</TITLE>
</HEAD>
<BODY>

<H2>Microprocessors Lecture 12</H2>
<H3>Serial Interfaces</H2>
Serial interface chips are commonly called
ACIAs (Asynchronous Communications Interface Adapter)
or UARTs (Universal Asynchronous Receiver/Transmitter).
<P>
An ACIA contains the hardware to interface RS232 signals to the
microprocessor.   Since true RS232 signals are not TTL-compatible,
buffers are used to bring these into TTL/CMOS levels.
<P>
The ACIA also provides error checking and synchronisation functions.
<H3>6850 ACIA</H3>
The 6850 is commonly used with Motorola microprocessors.
It contains 4 registers:
<PRE>
	Tx data register
	Control register
	Status register
	Rx data register
</PRE>
but has only one register select line (i.e. 2 addresses only).

This is because the first two registers are <I>WRITE-only</I> and
the last two registers are <I>READ-only</I>.
<P>
In passing, note that normal instructions such as <I>INC, DEC</I> and <I>SHIFT</I>
will not work with this kind of register usage since when you read or
write, you are accessing a different register.   Only <I>LOAD</I> and
<I>STORE</I> instructions are valid for the registers above.
<P>
There is no <I>RESET</I> signal on the 6850.   A <I>Master Reset</I> command
has to be given to the <I>Control Register</I>.

<H3>Transmit</H3>
A <I>WRITE</I> to the <I>Tx Data Register</I> initiates the sending of a serial character.
Remember that the 6809 can write to a register in a few microseconds.
It will take the ACIA around 1 ms to transmit that character at 9600 baud.
So new characters should not be written to the ACIA until the precious
character has been transmitted.
<P>
The end of transmission of a character can be detected by a bit in the
<I>Status Register</I>, SR1 which is otherwise called <I>TRDE</I> -
Transmit Data Register Empty.
<P>
Once a character has been moved from the Tx Data Register to the ACIA's
Tx shift register, the TDRE flag is cleared.   So another character can
be queued whilst one is being transmitted.

<H3>Receive</H3>
When a character has been received (i.e. the last bit has been copied into the
Rx shift register) then the <I>RDRF</I> (Receive Data Register
Ready) flag (SR0) is set.
<P>
When the Rx Data Register is read, then the RDRF flag is automatically cleared,
although the data remains in the register until overwritten by a new 
received character.

<H3>Interrupts</H3>
Setting of the TDRE and RDRE flags may cause interrupts, if the Control Register is
so programmed.

<H3>Control Register</H3>
<CENTER>
<TABLE BORDER WIDTH=60% CELLPADDING=5 BGCOLOR=#ffffc0>
<TR><TH WIDTH=12%>7<TH WIDTH=12%>6<TH WIDTH=12%>5<TH WIDTH=12%>4<TH WIDTH=12%>3
<TH WIDTH=12%>2<TH WIDTH=12%>1<TH WIDTH=12%>0</TR>

<TR><TH>Rx<br>interrupt<br>control<TH COLSPAN=2>Tx<br>interrupt<br>control
<TH COLSPAN=3>set data word<br>format<TH COLSPAN=2>Clock divider /<br>Master Reset</TR>
</TABLE>
</CENTER>
<P>
A write to CR1,0 of '11' causes a Master Reset which
clears all registers (except SR bit 3).
<P>
The number of bits, parity selection and number of <I>STOP</I> bits
are selected by CR2,3,4.
<P>
CR5,6 set the Tx interrupt options and CR7 sets the Rx interrupt option.

<H3>Status Register</H3>
<CENTER>
<TABLE BORDER WIDTH=60% CELLPADDING=5 BGCOLOR=#ffff80>
<TR><TH WIDTH=12%>7<TH WIDTH=12%>6<TH WIDTH=12%>5<TH WIDTH=12%>4<TH WIDTH=12%>3
<TH WIDTH=12%>2<TH WIDTH=12%>1<TH WIDTH=12%>0</TR>

<TR><TH>/IRQ<TH>PE<TH>OVRN<TH>FE<TH>/CTS<TH>/DCD<TH>TDRE<TH>RDRF</TR>
</TABLE>
</CENTER>
<P>
<I>DCD</I> indicates when a modem carrier is present.  This
signal is output by the modem.<br>
<I>CTS</I> is an input to the ACIA which inhibits the transmission
of new data.<br>
<I>FE</I> is set if a framing error has occurred.  This means that
an expected STOP bit was not received.<br>
<I>OVRN</I> is set if an overrun error occurred.   This means that
a new character was received in the Rx data register before the
previous character was read by the microprocessor.  Data is lost
in such circumstances.<br>
<I>PE</I> shows that a Parity error occurred.<br>
<I>IRQ</I> shows if the 6850 is sending an interrupt signal.
This flag is cleared when the Control Register is read.
<P>
These flags are automatically reset when the next character arrives
or when data is read from the 6850.
<P>
<I>RTS</I> is generated by the ACIA when the Rx shift register is
full and the data has not been read by the microprocessor.  This
signal may be used to prevent a remote modem from transmitting
further data.
<P>
<I>Xon/Xoff</I> is a software protocol which tells a remote system to
stop sending data.   This can be used in place of RTS/CTS hardware 
signals.   However, owing to the time taken to transmit the Xoff
character itself, the receiver must have some buffering capability.
<br>
Xoff may be sent from the keyboard by typing CTRL-S and Xon by
typing CTRL-Q.

<hr><CENTER>
| <A HREF="micros.htm">Back</A> | <A HREF="up13.htm">Next</A> |</CENTER>

</BODY>
</HTML>